<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduBuddy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body>
    <header class="page-header">
      <div class="container">
        <a href="/">EduBuddy</a>
        {% if logged_in %}
          <a href="{{ url_for('logout') }}" class="logout-btn">–í–∏–π—Ç–∏</a>
        {% else %}
          <a href="{{ url_for('login') }}" class="login-btn">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</a>
        {% endif %}
      </div>
    </header>

    <div class="page-layout">
      <!-- Tasks Section (Left Side) -->
      {% if logged_in and tasks %}
      <aside class="tasks-sidebar">
        <div class="table-title">
          <h2>–ü–æ—Ç–æ—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
          <button id="toggle-tasks-btn" class="toggle-btn expanded">–°—Ö–æ–≤–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
        </div>
        <div class="tasks-table-wrapper" id="tasks-table-wrapper">
          <table class="tasks-table" id="tasks-table">
            <thead>
              <tr>
                <th>–ö—É—Ä—Å</th>
                <th>–ó–∞–≤–¥–∞–Ω–Ω—è</th>
                <th>–î–∞—Ç–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î—ñ—ó</th>
              </tr>
            </thead>
            <tbody>
              {% for task in tasks %}
              <tr {% if loop.index0 == selected_task_index %}class="selected-task"{% endif %}>
                <td>{{ task.course }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.due }}</td>
                <td>{{ task.state }}</td>
                <td>
                  <form method="post" action="{{ url_for('complete_task', task_index=loop.index0) }}" style="display:inline;">
                    <button type="submit" class="action-btn complete-btn" {% if task.state == '–í–∏–∫–æ–Ω–∞–Ω–æ' %}disabled{% endif %}>‚úì</button>
                  </form>
                  <form method="post" action="{{ url_for('remove_task', task_index=loop.index0) }}" style="display:inline;">
                    <button type="submit" class="action-btn remove-btn">‚úó</button>
                  </form>
                  <form method="post" style="display:inline;">
                    {% if loop.index0 == selected_task_index %}
                      <input type="hidden" name="deselect_task" value="1" />
                      <button type="submit" class="action-btn deselect-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    {% else %}
                      <input type="hidden" name="select_task" value="1" />
                      <input type="hidden" name="task_index" value="{{ loop.index0 }}" />
                      <button type="submit" class="action-btn select-btn">–í–∏–±—Ä–∞—Ç–∏</button>
                    {% endif %}
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </aside>
      {% endif %}

      <!-- Main Content (unchanged) -->
      <main class="main-content">
        {% if not started_chat %}
        <section class="dialog">
          <div class="container-form">
            <div class="dialog-wrapper" id="chat-container">
              <div class="centered-answer">
                <div class="start-form">
                  <form method="post" class="survey-form" id="survey-form">
                    <p class="answer">–ü—Ä–æ–π–¥–∏ –∫–æ—Ä–æ—Ç–∫–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è, —â–æ–± –º–∏ –∫—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ–ª–∏, —è–∫ —Ç–æ–±—ñ –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ üëá</p>
                    <label for="topic">–©–æ —Ç–∏ —Ö–æ—á–µ—à –≤–∏–≤—á–∏—Ç–∏?</label>
                    <input type="text" name="topic" required value="{{ topic or '' }}" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –¢–µ–æ—Ä—ñ—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π" />
                    <label for="level">–û—Ü—ñ–Ω–∏ —Å–≤—ñ–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞–Ω—å:</label>
                    <select name="level">
                      <option value="–ø–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å" {% if level == '–ø–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å' %}selected{% endif %}>–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å</option>
                      <option value="—Å–µ—Ä–µ–¥–Ω—ñ–π" {% if level == '—Å–µ—Ä–µ–¥–Ω—ñ–π' %}selected{% endif %}>–°–µ—Ä–µ–¥–Ω—ñ–π</option>
                      <option value="–ø—Ä–æ—Å—É–Ω—É—Ç–∏–π" {% if level == '–ø—Ä–æ—Å—É–Ω—É—Ç–∏–π' %}selected{% endif %}>–ü—Ä–æ—Å—É–Ω—É—Ç–∏–π</option>
                    </select>
                    <button type="submit">–ü–æ—á–∞—Ç–∏ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>
        <img src="{{ url_for('static', filename='images/1.png') }}" alt="Decoration" class="bottom-right-image" />
        <img src="{{ url_for('static', filename='images/2.png') }}" alt="Decoration" class="bottom-left-image" />
        {% else %}
        <section class="dialog">
          <div class="container">
            <div class="dialog-wrapper" id="chat-container">
              {% for msg in chat_history %}
                {% if msg.role == "assistant" %}
                  <div class="answer-wrapper assistant">
                    <div class="description">{{ msg.content | markdown | safe }}</div>
                  </div>
                {% elif msg.role == "user" %}
                  <div class="answer-wrapper user">
                    <div class="description">{{ msg.content | e }}</div>
                  </div>
                {% endif %}
              {% endfor %}
              <form class="chat-form" method="post" id="chat-form">
                <input name="chat" value="1" type="hidden" />
                <input class="q-input" type="text" name="question" placeholder="–ù–∞–ø–∏—à–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è..." required />
                <button type="submit">
                  <svg class="icon-arrow-up" width="40" height="40">
                    <use href="{{ url_for('static', filename='images/icons.svg') }}#icon-arrow-up"></use>
                  </svg>
                </button>
              </form>
            </div>
          </div>
        </section>
        {% endif %}
      </main>
    </div>

    <!-- Overlay for Loading -->
    <div class="overlay" id="overlay">
      <div class="loader"></div>
    </div>

    <footer class="page-footer">
      <div class="container">
        <p>Hackathon project <span class="bolded">EduBuddy</span></p>
      </div>
    </footer>


    <!-- JavaScript for Toggle Animation -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const toggleButton = document.getElementById('toggle-tasks-btn');
        const tableWrapper = document.getElementById('tasks-table-wrapper');

        toggleButton.addEventListener('click', function () {
          tableWrapper.classList.toggle('hidden');

          if (tableWrapper.classList.contains('hidden')) {
            toggleButton.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è';
          } else {
            toggleButton.textContent = '–°—Ö–æ–≤–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è';
          }
        });
      });
      document.addEventListener("DOMContentLoaded", function () {
    const overlay = document.getElementById("overlay");

    // Attach to all form submits
    const forms = document.querySelectorAll("form");
    forms.forEach(form => {
      form.addEventListener("submit", function () {
        overlay.classList.add("active");
      });
    });
  });
    </script>

    <!-- Inline CSS for Animation -->
    <style>
      .tasks-table-wrapper {
        max-height: 1500px; /* Adjust this value based on your table's max height */
        overflow: hidden;
        transition: max-height 0.5s ease-in-out; /* Smooth animation */
      }

      .tasks-table-wrapper.hidden {
        max-height: 0;
      }
    </style>
  </body>
</html>